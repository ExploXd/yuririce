#!/bin/sh
# This script will run Spotify and `spotifyupdate` script along with it.

echo "🔄" > /tmp/spotifyloading # Spotify loading icon
pkill -RTMIN+11 i3blocks # Refresh statusbar

spotifyupdate & # Run `spotifyupdate`
spotify & # Start Spotify

sleep 5 # Sleep for 5 seconds

pid=$(ps -A | grep -w spotify | awk '{print $1}' | sed -n 1p) # Get Spotify pid, so the script can wait on it.

rm /tmp/spotifyloading # Remove Spotify loading icon
pkill -RTMIN+11 i3blocks # Refresh status bar

wait "$pid" # Wait until Spotify is killed.

killall "spotifyupdate" # Kill `spotifyupdate`, because of performance.

echo "❎" > /tmp/spotifyloading # Spotify killed icon
pkill -RTMIN+11 i3blocks # Refresh statusbar
sleep 1 # Sleep for 1 second
rm /tmp/spotifyloading # Remove Spotify killed icon
pkill -RTMIN+11 i3blocks # Refresh statusbar
